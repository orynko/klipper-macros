[gcode_macro m900]
description: Sets pressure advance.
    Usage: M900 [K<advance>] [T<extruder_index>]
gcode:
    {% set km = printer["gcode_macro _config"] %}
    {% if km.pressure_advance_scale > 0.0 %}
        {% set extruder = "extruder" ~ params.T|replace('0', '')
            if "T" in params else printer.toolhead.extruder 
        %}
        {% if 'K' in params %}
            SET_PRESSURE_ADVANCE EXTRUDER="{extruder}" ADVANCE="{
                params.K|float * km.pressure_advance_scale
            }"
        {% endif %}
    {% endif %}